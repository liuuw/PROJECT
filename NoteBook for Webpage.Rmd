



  I would like to know the relationship between droupout rate(county) and other information. For example, how does school districts' total budget, median household income and unemployment rate affect the droupout rate? Are they positive correlation? Or are there significant difference between rural and urban areas?

Here are the links that my data comes from:

1.Shape File: 
https://data.wa.gov/Demographics/WAOFM-GIS-County-Boundary/sep2-mdr8/data

2.Rural and urban areas: https://www.doh.wa.gov/Portals/1/Documents/1500/RUCAGuide.pdf

3.Census Data:
State of Washington Open Data Platform and 
http://data.spokesman.com/census/2010/washington/counties/

4.School Districts and Public Schools' data:
National Center for Education Statistics
https://www.ofm.wa.gov/washington-data-research/population-demographics/population-estimates/small-area-estimates-program

5. Schools' budgets:
https://nces.ed.gov/edfin/search/peergroupdata.asp?dataid=1&subdataid=1&mt=0&jobid={CDB9F6CF-266C-41A9-87ED-E0867B2EA370}

6.Household Incomes:
https://www.ofm.wa.gov/sites/default/files/public/legacy/economy/hhinc/medinc.pdf

7.Droupout rats:
https://dev.socrata.com/foundry/data.wa.gov/6g87-pu72



##Part1. Reading the data 

```{r}
dropout<-read.csv("https://github.com/liuuw/PROJECT/raw/master/DROUPOUT_DATA.csv")

dim(dropout)
names(dropout)
```

I choose some of relevent variables in the dataset that I believe have connection with the dependent varibable(dropout rates) to do the analysis.

Since there's no missing value in WA counties' census records or schools' data, basic excel function like 'if','countif','sum' can clean the data well. 

We can see that there are 39 counties in WA. I pick up 14 possible independent variables in total for each county and am wandering which might relate to the droupout rate best. 

There are also 39 counties in the attribute table of the WA shape file, which is really handy for us to use the function 'join' later to merge the data and show it on the map. 

But for now, let's look at the univariate exploration first. 

```{r}
str(dropout)
```
##Univariate exploration:
Turn our attention to counties whose been classified as Rural/Urban. This is the distribution of its values nad its relative frequencies.
```{r}
is.data.frame(dropout)
length(dropout)
table(dropout$Region)
prop.table(table(dropout$Region))
```

Then we can run Chi-square test to see if the difference is significant and how's the measure of centrality for the Region (dichotomous values):
```{r}
library(tidyverse)
prop.table(table(dropout$Region))%>%chisq.test() # In order to see the value of X-squared

distribution= table(dropout$Region) # To see whether Rural or Urban area are the counities in
modeCount=max(distribution)
mode=distribution[distribution==modeCount]
names(mode)
```

Let's see the revenue difference between Rural and Urban areas. (ggplot)
```{r}
library(ggthemes)
library(tidyverse)
library(ggplot2)

dropout %>% 
  group_by(County) %>% 
  summarise(avg_amount = mean(TotalRevenuePerStudent, na.rm = TRUE)) %>%
  ggplot(aes(reorder(County, -avg_amount), avg_amount)) +
  geom_bar(stat = 'identity') + 
  scale_y_continuous() + theme_classic()


```

Letâ€™s consider for this section the variable that tells us the highest total dropout rate and revenue according to each county.

```{r}
library(DescTools)
Mode(dropout$TotalRevenuePerStudent)
Median(dropout$TotalRevenuePerStudent)

```


```{r}
is.data.frame(dropout)
head(dropout)
data <-dropout[,-17]
```

#Histogram
```{r}
hist(x=dropout$Dropout_Rate, 
     main="Histogram of Dropout Rate",         # Name of picture
     xlab="Numbers of County (39 Counties in Total)",                      # Name of X-axis
     ylab="Percent") 


```

##Regression
```{r}
plot(x=dropout$Dropout_Rate,      #  Values for X axis
     y=dropout$unemployment_rate,       # Values for Y axis
     main="Correlation Between Unemployment Rate and Dropout Rate",    # Title
     xlab="Dropout Rate(%)",       # Name of X axis
     ylab="Unemploymeny rate(%)"         # Name of Y axis
)

abline(lm(unemployment_rate~ Dropout_Rate, data=dropout))  # Linear model
```


Let's try it again 
```{r}
plot(x=dropout$Dropout_Rate,      #  Values for X axis
     y=dropout$single_female_with_children,       # Values for Y axis
     main="Correlation Between Dropout Rate and the Ratio of Single Mother",    # Title
     xlab="Dropout Rate(%)",       # Name of X axis
     ylab="The Proportion of Single Mother (%)"         # Name of Y axis
)
abline(lm(single_female_with_children~ Dropout_Rate, data=dropout))
```




##Clustering

```{r}
library(cluster)
demoSimi=daisy(dropout[,c(2:16)],metric = "euclidean",
               stand=TRUE)
demoClus=hclust(demoSimi,method = 'average')
```

```{r}
GG<-data%>% dist(method="euclidean")%>% hclust(method= "ward.D2")%>% 
  plot()%>% par(mfrow=c(1,2))%>%abline(h=9, col="red")


```




```{r}
data <- dropout[, -1]
E.dist <- dist(data, method="euclidean")
E.dist %>% hclust()%>% plot()%>% par(mfrow=c(1,2))
library("tidyverse")
Cluster<-data%>% dist(method="euclidean")%>% hclust(method= "ward.D2")

```


##Mapping 
```{r}
library(jsonlite)
is.data.frame(dropout)  
dropout1=dropout[,c('County','TotalRevenuePerStudent','Student_number')]
str(dropout1)
Map="https://github.com/liuuw/PROJECT/raw/master/WAOFM%20-%20GIS%20-%20County%20Boundary.zip"
```
```{r}
library(utils)
temp=tempfile()
download.file(Map, temp)
unzip(temp)
(maps=list.files(pattern = 'shp'))

library(rgdal)
wazipMap <- rgdal::readOGR("geo_export_109cf655-8ce8-4eea-8b93-dc816b22de53.shp",stringsAsFactors=F) # use name
names(wazipMap)
str(wazipMap$name)
str(dropout$County)
contribWAmap=merge(wazipMap,dropout, by.x='name', by.y='County',all.x=F)
nrow(contribWAmap)
plot(wazipMap,col='black')
plot(contribWAmap,col='pink',border='grey',add=T)
```



```{r}
library(RColorBrewer)
library(classInt)
varToPLot=contribWAmap$Dropout_Rate

numberOfClasses = 5
colorForScale='YlGnBu'
colors = brewer.pal(numberOfClasses, colorForScale)
intervals <- classIntervals(varToPLot, numberOfClasses, 
                            style = "quantile",
                            dataPrecision=2)
colorPallette <- findColours(intervals, colors)

legendText="Dropout rate (%)"
shrinkLegend=0.4
title="Dropout Rate by County"

plot(wazipMap,col='red',main=title)
plot(contribWAmap, col = colorPallette,border='grey',add=T)

legend('topright', legend = names(attr(colorPallette, "table")), 
       fill = attr(colorPallette, "palette"), cex = shrinkLegend, 
       bty = "n",
       title=legendText)



```


```{r}
library(RColorBrewer)
library(classInt)
varToPLot=contribWAmap$TotalRevenuePerStudent

numberOfClasses = 5
colorForScale='YlGnBu'
colors = brewer.pal(numberOfClasses, colorForScale)
intervals <- classIntervals(varToPLot, numberOfClasses, 
                            style = "quantile",
                            dataPrecision=2)
colorPallette <- findColours(intervals, colors)

legendText="Revenue Per student($)"
shrinkLegend=0.4
title="Total Revenue Per Student In WA"

plot(wazipMap,col='red',main=title)
plot(contribWAmap, col = colorPallette,border='grey',add=T)

legend('topright', legend = names(attr(colorPallette, "table")), 
       fill = attr(colorPallette, "palette"), cex = shrinkLegend, 
       bty = "n",
       title=legendText)

```